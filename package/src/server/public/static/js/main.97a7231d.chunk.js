(this.webpackJsonpwebsite=this.webpackJsonpwebsite||[]).push([[0],{138:function(e,t,n){},164:function(e,t,n){},166:function(e,t,n){"use strict";n.r(t);var a,i=n(0),r=n.n(i),s=n(16),o=n.n(s),c=n(14),l=n(13),u=n(21),d=n(20),h=(n(138),n(44)),b=n(217),m=n(208),j=n(211),p=n(169),f=n(219),v=n.p+"static/media/elabLogo.6161d4d0.svg",g=n(4),y=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e={padding:"2vh 0.5vw"};return Object(g.jsx)(m.a,{position:"static",children:Object(g.jsxs)(j.a,{children:[Object(g.jsx)("div",{style:e,children:Object(g.jsx)(p.a,{variant:"h4",style:{paddingLeft:"10vw",paddingRight:"0.2vw"},children:Object(g.jsx)(f.a,{fontWeight:"fontWeightBold",children:"Limes Portal"})})}),Object(g.jsx)("img",{src:v,alt:"eLab",height:"40vw",width:"40vw"}),Object(g.jsx)("div",{style:e,children:Object(g.jsx)(p.a,{variant:"subtitle1",children:"Powered by eLab"})})]})})}}]),n}(r.a.Component),O=n(7),S=n(220),x=n(212),k=n(213),C=n(86),w=n(51),L=n(216),P=n(172),T=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).passwordRef=void 0,a.loginRef=void 0,a.defaultLabel="",a.elabService=void 0,a.state={username:"",password:"",open:!0,error:!1,label:a.defaultLabel,loading:!1,tried:!1},a.elabService=e.elabService,a}return Object(l.a)(n,[{key:"loginFailed",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.setState({error:!0,label:e,loading:!1,tried:t})}},{key:"loginSuccess",value:function(){this.setState({open:!1,loading:!1,tried:!1})}},{key:"login",value:function(){var e=this;this.state.tried||(this.setState({label:"",loading:!0}),this.state.username&&this.state.password?this.elabService.Login(this.state.username,this.state.password).then((function(t){var n=Object(O.a)(t,2),a=n[0],i=n[1];a?e.loginSuccess():e.loginFailed(i)})).catch((function(t){console.error(t),e.loginFailed("string"===typeof t?t:"No response. Are you on the UBC network?",!1)})):this.loginFailed("fields cannot be empty"))}},{key:"onClose",value:function(){}},{key:"render",value:function(){var e=this,t={},n={width:"100%",marginBottom:"1em"},a=[{name:"username",label:"Username",placeholder:"username",onchange:function(t){e.setState({error:!1,tried:!1,username:t.target.value})}},{name:"password",label:"Password",placeholder:"*****",type:"password",onchange:function(t){e.setState({error:!1,tried:!1,password:t.target.value})},onkeydown:function(t){var n;"Enter"===t.key&&(null===(n=e.loginRef)||void 0===n||n.focus())}}];return Object(g.jsx)(S.a,{open:this.state.open,onClose:this.onClose,style:{},children:Object(g.jsx)(x.a,{container:!0,spacing:0,direction:"column",alignItems:"center",justify:"center",style:{outline:"transparent",height:"100%"},children:Object(g.jsx)(k.a,{style:{outline:"transparent",padding:"1em 2em 1.2em 2em",width:"25em"},children:Object(g.jsxs)(x.a,{container:!0,justify:"center",direction:"column",style:{},spacing:0,children:[Object(g.jsx)(p.a,{variant:"h5",component:"h2",align:"center",style:t,children:"Login"}),Object(g.jsx)(p.a,{variant:"subtitle1",align:"center",color:"error",style:t,children:this.state.label}),Object(g.jsx)(x.a,{item:!0,container:!0,justifyContent:"center",direction:"column",children:Object(g.jsx)("form",{children:a.map((function(t){return Object(g.jsx)(x.a,{item:!0,children:Object(g.jsx)(C.a,{label:t.label,name:t.name,placeholder:t.placeholder,style:n,type:t.type,error:e.state.error,onChange:t.onchange,onKeyDown:t.onkeydown})},t.name)}))})}),Object(g.jsx)(x.a,{container:!0,justify:"center",children:Object(g.jsxs)(w.a,{variant:"contained",color:"primary",style:{width:"10em"},disabled:this.state.loading,onClick:function(){e.login()},ref:function(t){e.loginRef=t},children:["Login",Object(g.jsx)(L.a,{in:this.state.loading,children:Object(g.jsx)(P.a,{size:20,thickness:5,style:{position:"absolute"}})})]})})]})})})})}}]),n}(r.a.Component),D=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return n}(T),I=D,A=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(c.a)(this,n),(a=t.call(this,e)).mainText=void 0,a.onClick=void 0,a.settings=void 0;var i=e.settings;return a.settings=e.settings,a.mainText=i.name,a.state={disabled:i.disabled,cardStyle:{width:"200px",height:"200px",border:"2px solid transparent",background:i.disabled?"lightgrey":"",cursor:i.disabled?"":"pointer"}},a.onClick=e.onClick,a}return Object(l.a)(n,[{key:"onHover",value:function(){if(!this.state.disabled){var e={};Object.assign(e,this.state.cardStyle),e.border="2px solid ".concat(this.props.theme.palette.primary.main),this.setState({cardStyle:e})}}},{key:"onLeave",value:function(){if(!this.state.disabled){var e={};Object.assign(e,this.state.cardStyle),e.border="2px solid transparent",this.setState({cardStyle:e})}}},{key:"render",value:function(){var e=this;return Object(g.jsx)(k.a,{style:this.state.cardStyle,onClick:this.state.disabled?function(){}:function(){return e.onClick(e.settings)},onMouseEnter:function(){e.onHover()},onMouseLeave:function(){e.onLeave()},children:Object(g.jsx)(x.a,{container:!0,spacing:0,justifyContent:"center",alignItems:"center",direction:"column",style:{height:"100%"},children:Object(g.jsx)(x.a,{item:!0,children:Object(g.jsx)(p.a,{variant:"h5",component:"h2",children:this.mainText})})})})}}]),n}(r.a.Component),B=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).cardClicked=void 0,a.state={functions:e.functions},a.cardClicked=e.clicked,a}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return Object(g.jsx)(x.a,{style:{marginTop:"10vh"},children:Object(g.jsx)(x.a,{container:!0,justifyContent:"center",spacing:5,children:this.state.functions.map((function(t){return Object(g.jsx)(x.a,{item:!0,children:Object(g.jsx)(A,{theme:e.props.theme,settings:t,onClick:e.cardClicked})},t.name)}))})})}}]),n}(r.a.Component),N=n(218),E=n(72);!function(e){e.SAMPLE="Sample",e.STORAGE_LOCATION="Location",e.CUSTOM="Unknown"}(a||(a={}));var R=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).apiService=void 0,a.UPDATE_DELAY=650,a.apiService=e.elabService,a.state={labels:[],labelsRaw:"",printDisabled:!0,printAllDisabled:!1,lastChange:Date.now(),printing:!1,gettingData:!1,labelTemplateName:""},a}return Object(l.a)(n,[{key:"toBarcodes",value:function(e){return e?e.map((function(e){for(var t=e.id,n="".concat(t);n.length<15-"005".length;)n="0".concat(n);return"".concat("005").concat(n)})):[]}},{key:"componentDidMount",value:function(){this.props.startingSamples&&this.parseLabels(this.toBarcodes(this.props.startingSamples))}},{key:"parseLabels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];0===t.length&&(t=this.state.labelsRaw.split("\n")),t=t.filter((function(e){return e.trim().length>0}));var n=function(e){return!/[^0-9]/.test(e)},i=(t.map(n),t.filter(n)),r=function(e){var t=Math.max(0,e.length-5);return t?"...".concat(e.substring(t)):e};this.apiService.BarcodeLookup(i).then((function(i){var s=t.map((function(e){if(void 0===i[e]){var t=e.includes("\t")?e.split("\t"):e.split(" "),s={id:"",bar:"",text:e,type:a.CUSTOM};if(t.length>1&&n(t[0])){var o=t.shift();s.bar=o?r(o):"",s.id=o||"",s.text=t.join(" ")}else s.id="",s.bar="",s.text=e;return s}var c=i[e];return{bar:r(e),id:e,text:c.name,type:c.sampleID?a.SAMPLE:a.STORAGE_LOCATION}}));e.setState({labels:s})})).catch((function(e){console.error(e)})).finally((function(){e.setState({gettingData:!1})})),this.setState({gettingData:!0})}},{key:"onLabelInputChanged",value:function(e){var t=this,n=e.target.value;this.setState({labelsRaw:n,lastChange:Date.now()}),setTimeout((function(){Date.now()-t.state.lastChange>=t.UPDATE_DELAY&&t.parseLabels()}),this.UPDATE_DELAY)}},{key:"onPrint",value:function(){}},{key:"onPrintAll",value:function(){var e=this,t={Labels:this.state.labels.map((function(e){return{Barcode:e.id,Texts:[e.text]}})),TemplateName:this.state.labelTemplateName};this.setState({printing:!0});var n=function(){e.setState({printing:!1})};this.apiService.PrintLabels(t).then((function(t){var a=25;!function i(){--a<=0?n():setTimeout((function(){e.apiService.PollPrintReport(t).then((function(e){e&&""!==e?(n(),alert(e)):i()}))}),500)}()}))}},{key:"render",value:function(){var e=this,t=["123 box 23","005000000123456","..."].join("\n");return Object(g.jsx)(x.a,{container:!0,justifyContent:"center",style:{marginTop:"5vh",justifyContent:"center",alignItems:"center",alignContent:"center"},children:Object(g.jsx)(k.a,{style:{padding:"2em"},children:Object(g.jsxs)(x.a,{container:!0,direction:"column",spacing:3,children:[Object(g.jsx)(x.a,{item:!0,children:Object(g.jsx)(p.a,{variant:"h5",component:"h2",align:"left",gutterBottom:!0,style:{},children:"Print Labels"})}),Object(g.jsx)(x.a,{item:!0,children:Object(g.jsx)(C.a,{label:"Items",placeholder:t,multiline:!0,variant:"outlined",style:{width:"70em"},defaultValue:this.toBarcodes(this.props.startingSamples).join("\n"),onChange:function(t){e.onLabelInputChanged(t)}})}),Object(g.jsxs)(x.a,{item:!0,style:{height:"30em"},justify:"center",children:[Object(g.jsx)(L.a,{in:this.state.gettingData,style:{position:"absolute",marginTop:"5em"},children:Object(g.jsx)(P.a,{size:50})}),Object(g.jsx)(E.a,{rows:this.state.labels,columns:[{field:"disabled",hide:!0},{field:"id",headerName:"ID",hide:!0},{field:"bar",headerName:"Barcode",width:100,sortable:!1},{field:"text",headerName:"Text",width:600,sortable:!1}],rowsPerPageOptions:[100],onPageSizeChange:function(){},isRowSelectable:function(e){return!e.row.disabled},disableSelectionOnClick:!0,disableColumnMenu:!0,disableColumnFilter:!0,disableColumnSelector:!0,style:{opacity:this.state.gettingData?.25:1}}),Object(g.jsx)(x.a,{item:!0,children:Object(g.jsx)(L.a,{in:this.state.printing,children:Object(g.jsx)(N.a,{})})})]}),Object(g.jsx)(x.a,{item:!0,children:Object(g.jsx)(C.a,{label:"Label Template Name",placeholder:"default",variant:"outlined",style:{width:"70em"},onChange:function(t){e.setState({labelTemplateName:t.target.value})}})}),Object(g.jsx)(x.a,{item:!0,children:Object(g.jsx)(w.a,{variant:"contained",color:"primary",disabled:this.state.printAllDisabled,style:{margin:"0 1em 0 1em"},onClick:function(){return e.onPrintAll()},children:"Print All"})})]})})})}}]),n}(r.a.Component),U=n(110),F=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).apiService=void 0,a.UPDATE_DELAY=650,a.apiService=e.elabService,a.state={searching:!1,results:"",lastChange:Date.now(),storages:[],selectedSamples:[],errorText:"",errorCands:"",currentLocation:""},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=5;!function n(){if(e.apiService.LoggedIn())e.apiService.GetStorages().then((function(t){if(!t)return 0;var n=t.reduce((function(e,t){var n=t.name,a=t.storageLayerID,i={id:a,name:n.toLowerCase(),parent:t.parentStorageLayerID,children:[]};return e.set(a,i),e}),new Map),a=[];n.forEach((function(e,t,i){var r;0===e.parent?a.push(e):null===(r=n.get(e.parent))||void 0===r||r.children.push(e)})),e.setState({storages:a})}));else{if(--t<=0)return;setTimeout((function(){n()}),100)}}()}},{key:"doSearch",value:function(e){var t=this;return new Promise((function(n){var a,i,r=e.split(",").map((function(e){return e.trim()})),s=function(e,t){var n=t.split(" ");return e.filter((function(e){return n.reduce((function(t,n){return t&&e.name.includes(n)}),!0)}))},o="",c=!0,l=t.state.storages,u=Object(U.a)(r);try{for(u.s();!(i=u.n()).done;){var d=i.value,h=s(l,d=d.toLowerCase());if(1!==h.length){if(0===h.length){c=!1,t.setState({searching:!1,errorText:"No storage location with name [".concat(d,"]")});break}c=!1,t.setState({searching:!1,errorText:"Ambiguity for [".concat(d,"] between:"),errorCands:"".concat(h.map((function(e){return e.name})).join(", "))});break}var b=h[0];l=b.children,o+=", ".concat(b.name),a=b,t.setState({errorText:"",errorCands:""})}}catch(m){u.e(m)}finally{u.f()}if(!c||!a)return n(0);t.setState({currentLocation:o}),n(a.id)}))}},{key:"getSamples",value:function(e){var t=this;return this.apiService.GetSamplesByStorage(e).then((function(e){e||(e=[]),t.setState({selectedSamples:e.map((function(e){return{id:e.sampleID,name:e.name,type:e.sampleType.name}})),searching:!1})}))}},{key:"onSearchChanged",value:function(e){var t=this,n=e.target.value;this.setState({lastChange:Date.now()}),setTimeout((function(){Date.now()-t.state.lastChange>=t.UPDATE_DELAY&&(t.setState({searching:!0}),t.doSearch(n).then((function(e){if(console.log(e),0!==e)return t.getSamples(e)})))}),this.UPDATE_DELAY)}},{key:"render",value:function(){var e=this,t={margin:"0 1em 0 1em"};return Object(g.jsx)(x.a,{container:!0,justifyContent:"center",style:{marginTop:"5vh",justifyContent:"center",alignItems:"center",alignContent:"center"},children:Object(g.jsx)(k.a,{style:{width:"90vw",padding:"2em"},children:Object(g.jsxs)(x.a,{container:!0,direction:"column",spacing:3,children:[Object(g.jsx)(x.a,{item:!0,children:Object(g.jsx)(p.a,{variant:"h5",component:"h2",align:"left",gutterBottom:!0,style:{},children:"Samples By Storage Location"})}),Object(g.jsx)(x.a,{item:!0,children:Object(g.jsx)(C.a,{label:"Search",placeholder:"freezer 7, self 2, rack 3",variant:"outlined",onChange:this.onSearchChanged.bind(this),style:{width:"90vw"}})}),Object(g.jsxs)(x.a,{item:!0,children:[Object(g.jsx)(p.a,{align:"left",style:{color:"primary"},children:this.state.currentLocation}),Object(g.jsx)(p.a,{align:"left",style:{color:"red"},children:this.state.errorText}),Object(g.jsx)(p.a,{align:"left",style:{color:"red"},children:this.state.errorCands})]}),Object(g.jsxs)(x.a,{item:!0,style:{height:"30em"},justify:"center",children:[Object(g.jsx)(L.a,{in:this.state.searching,style:{position:"absolute",marginTop:"5em"},children:Object(g.jsx)(P.a,{size:50})}),Object(g.jsx)(E.a,{rows:this.state.selectedSamples,columns:[{field:"disabled",hide:!0},{field:"id",headerName:"Barcode",width:100,sortable:!1},{field:"name",headerName:"Name",width:400,sortable:!1},{field:"type",headerName:"Type",width:350,sortable:!1}],rowsPerPageOptions:[100],onPageSizeChange:function(){},isRowSelectable:function(e){return!e.row.disabled},disableSelectionOnClick:!0,disableColumnMenu:!0,disableColumnFilter:!0,disableColumnSelector:!0,style:{opacity:this.state.searching?.25:1}})]}),Object(g.jsxs)(x.a,{item:!0,children:[Object(g.jsx)(w.a,{variant:"contained",color:"primary",onClick:function(){e.props.onPrintCallback(e.state.selectedSamples)},style:t,children:"Print Labels"}),Object(g.jsx)(w.a,{variant:"contained",color:"secondary",onClick:function(){e.apiService.ReloadStorages()},style:t,children:"Reload Storages"})]})]})})})}}]),n}(r.a.Component),M=n(111),q=n.n(M),G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(c.a)(this,e),this.baseUrl=void 0,this.requester=void 0,this.baseUrl=t,this.requester=q.a}return Object(l.a)(e,[{key:"genUrl",value:function(e){var t="".concat(this.baseUrl,"/").concat(e);return t.endsWith("/")?t.substring(0,t.length-1):t}},{key:"POST",value:function(e){var t=e.path,n=void 0===t?"":t,a=e.body,i=void 0===a?{}:a;return this.requester.post(this.genUrl(n),i)}}]),e}(),_=function(){function e(){Object(c.a)(this,e),this.clientID=void 0,this.firstname=void 0,this.lastname=void 0,this.requester=void 0,this.requester=new G("api/d1"),this.clientID="",this.firstname="",this.lastname=""}return Object(l.a)(e,[{key:"makeBody",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.ClientID=this.clientID,e}},{key:"LoggedIn",value:function(){return""!==this.clientID}},{key:"Login",value:function(e,t){var n=this;return this.requester.POST({path:"login",body:{Username:e,Password:t}}).then((function(e){var t=e.data;switch(t.Code){case 200:return n.clientID=t.ClientID,n.firstname=t.FirstName,n.lastname=t.LastName,console.log("logged in as ".concat(t.FirstName)),[!0,""];case 401:return[!1,"Incorrect username/password"];default:return Promise.reject("Oops, something crashed...")}}))}},{key:"BarcodeLookup",value:function(e){var t=this.makeBody({Barcodes:e});return this.requester.POST({path:"barcodes",body:t}).then((function(e){return e.data.Results}))}},{key:"GetStorages",value:function(){var e=this.makeBody();return this.requester.POST({path:"allstorages",body:e}).then((function(e){return e.data.Results}))}},{key:"GetSamplesByStorage",value:function(e){var t=this.makeBody({StorageLayerID:e});return this.requester.POST({path:"samplesbystorage",body:t}).then((function(e){return e.data.Results}))}},{key:"ReloadStorages",value:function(){var e=this.makeBody();this.requester.POST({path:"reloadcache",body:e})}},{key:"PrintLabels",value:function(e){var t=this.makeBody(e);return t.Op="print",this.requester.POST({path:"printops",body:t}).then((function(e){return e.data.ID}))}},{key:"PollPrintReport",value:function(e){var t=this.makeBody({ID:e,Op:"pollreport"});return this.requester.POST({path:"printops",body:t}).then((function(e){return e.data.Message}))}}]),e}(),z=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return n}(_),Y=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"GetApiService",value:function(){return this.I||(this.I=new z),this.I}}]),e}();Y.I=void 0;var W=Object(h.b)({palette:{primary:{main:"#00abab",contrastText:"#FFFFFF"},secondary:{main:"#d32f2f"},contrastThreshold:3,tonalOffset:.2}}),H=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(c.a)(this,n),(a=t.call(this,e)).defaultActiveComponent=void 0,a.elabService=void 0,a.elabService=Y.GetApiService();var i=[{name:"Print",disabled:!1,makeNextPage:function(){return Object(g.jsx)(R,{elabService:a.elabService})}},{name:"Search Storage Locations",disabled:!1,makeNextPage:function(){return Object(g.jsx)(F,{elabService:a.elabService,onPrintCallback:function(e){a.setState({activeComponent:Object(g.jsx)(R,{elabService:a.elabService,startingSamples:e})})}})}},{name:"Scanner coming soon!",disabled:!0}];return a.defaultActiveComponent=Object(g.jsx)(B,{theme:W,functions:i,clicked:function(e){return a.toFunctionPage(e)}}),a.state={activeComponent:a.defaultActiveComponent},a}return Object(l.a)(n,[{key:"toFunctionPage",value:function(e){e&&e.makeNextPage&&this.setState({activeComponent:e.makeNextPage()})}},{key:"render",value:function(){return document.getElementById("favicon").href="/forcefavicon",Object(g.jsx)(b.a,{theme:W,children:Object(g.jsxs)("div",{className:"app-container",children:[Object(g.jsx)(y,{}),Object(g.jsx)(I,{elabService:this.elabService}),this.state.activeComponent]})})}}]),n}(r.a.Component);n(164),n(165);o.a.render(Object(g.jsx)(r.a.StrictMode,{children:Object(g.jsx)(H,{})}),document.getElementById("root"))}},[[166,1,2]]]);
//# sourceMappingURL=main.97a7231d.chunk.js.map